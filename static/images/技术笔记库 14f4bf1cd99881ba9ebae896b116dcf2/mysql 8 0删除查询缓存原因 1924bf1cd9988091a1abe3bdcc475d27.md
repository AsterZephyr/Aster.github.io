# mysql 8.0删除查询缓存原因

Created: 2025年2月6日 09:43
Status: 完成

![image.png](mysql%208%200%E5%88%A0%E9%99%A4%E6%9F%A5%E8%AF%A2%E7%BC%93%E5%AD%98%E5%8E%9F%E5%9B%A0%201924bf1cd9988091a1abe3bdcc475d27/image.png)

MySQL 8.0 移除了查询缓存（Query Cache）功能，这一决策主要基于以下技术原因和实际场景考量：

### 1. **高并发场景下的性能瓶颈**

- **锁竞争与扩展性问题**：查询缓存在多核、高并发环境中会引发严重的锁竞争（如全局互斥锁），导致整体性能下降而非提升[[1][3][7]]。在高写入压力下，缓存频繁失效带来的维护成本甚至可能超过缓存带来的收益[[4][7][21]]。
- **资源消耗**：缓存需要占用内存空间（如 `query_cache_size` 至少分配 40KB），且维护缓存结构本身会带来额外开销[[3][6]]。

### 2. **缓存失效机制低效**

- **全表级失效**：任何对表的修改（如 `INSERT/UPDATE/DELETE`）会直接清空与该表相关的所有缓存结果，导致缓存命中率低下，尤其在写密集型应用中完全失效[[4][6][7][17]]。
- **非选择性失效**：即使修改表中一行数据，也会触发整个表的缓存失效，缺乏细粒度控制[[4][6]]。

### 3. **功能局限性**

- **严格的字节匹配**：查询语句必须完全一致（包括空格、注释等）才能命中缓存，实际应用中动态生成的查询语句难以复用[[4][6]]。
- **不支持非确定性函数**：若查询包含 `NOW()`、`RAND()` 或用户自定义函数（UDF），结果无法缓存[[4][6]]。
- **不兼容分区表**：涉及分区表的查询无法使用查询缓存[[3]]。

### 4. **替代方案的成熟**

- **应用层缓存**：Redis、Memcached 等外部缓存工具更灵活，可避免数据库层面的锁竞争，且支持细粒度的缓存策略[[4][5]]。
- **数据库自身优化**：InnoDB 缓冲池（Buffer Pool）的优化、更高效的索引策略和查询优化器的改进已显著提升性能，减少了对查询缓存的依赖[[4][26]]。

### 5. **工程维护成本**

- **代码复杂性**：查询缓存的实现逻辑复杂，与其他模块（如事务、锁机制）耦合度高，维护成本高昂[[4][26]]。
- **资源分配优先级**：MySQL 团队选择将开发资源投入更通用的性能优化（如并行查询、窗口函数），而非修补一个设计上存在根本缺陷的功能[[26][27]]。

---

### 技术演进与替代建议

尽管查询缓存在早期版本中对静态数据场景（如频繁读取不常修改的配置表）有效[[3][8]]，但现代数据库架构更倾向于：

- **ProxySQL 中间件**：提供更灵活的查询缓存机制，支持规则化缓存策略[[5][15]]。
- **优化查询与索引**：通过分析慢查询日志、使用覆盖索引或物化视图减少重复计算[[4][6]]。
- **内存与硬件升级**：利用大内存服务器直接提升 InnoDB 缓冲池命中率，或通过 SSD 加速数据读取[[6][26]]。

综上，查询缓存的移除是 MySQL 在性能、可扩展性和架构简洁性之间权衡后的必然结果，标志着数据库优化重点转向更普适的解决方案。

Citations:
[1] [https://dev.to/drupaladmin/mastering-mysqls-query-cache-key-variables-and-best-practices-for-optimization-27f7](https://dev.to/drupaladmin/mastering-mysqls-query-cache-key-variables-and-best-practices-for-optimization-27f7)
[2] [https://dev.to/arctype/the-basics-of-mysql-query-caching-35p2](https://dev.to/arctype/the-basics-of-mysql-query-caching-35p2)
[3] [https://dev.mysql.com/doc/refman/5.7/en/query-cache.html](https://dev.mysql.com/doc/refman/5.7/en/query-cache.html)
[4] [https://readyset.io/blog/mysql-5-7-eol-the-end-of-mysql-query-cache](https://readyset.io/blog/mysql-5-7-eol-the-end-of-mysql-query-cache)
[5] [https://community.aws/content/2fUJK8dG9EYXLr52nCWVRejCCf0/using-proxysql-to-replace-deprecated-mysql-8-0-query-cache](https://community.aws/content/2fUJK8dG9EYXLr52nCWVRejCCf0/using-proxysql-to-replace-deprecated-mysql-8-0-query-cache)
[6] [https://www.managedserver.eu/the-reasons-why-the-mysql-query-cache-was-abandoned-starting-with-mysql-8/](https://www.managedserver.eu/the-reasons-why-the-mysql-query-cache-was-abandoned-starting-with-mysql-8/)
[7] [https://www.pixelstech.net/article/1678545398-why-mysql-8-drops-support-of-query-cache](https://www.pixelstech.net/article/1678545398-why-mysql-8-drops-support-of-query-cache)
[8] [https://www.mysqlfaqs.net/mysql-faqs/Speed-Up-Queries/What-is-query-cache-in-MySQL](https://www.mysqlfaqs.net/mysql-faqs/Speed-Up-Queries/What-is-query-cache-in-MySQL)
[9] [https://dba.stackexchange.com/questions/44266/does-mysql-cache-queries](https://dba.stackexchange.com/questions/44266/does-mysql-cache-queries)
[10] [https://releem.com/docs/mysql-performance-tuning/query-cache](https://releem.com/docs/mysql-performance-tuning/query-cache)
[11] [https://stackoverflow.com/questions/58150081/how-does-cache-work-when-mysql-is-remote](https://stackoverflow.com/questions/58150081/how-does-cache-work-when-mysql-is-remote)
[12] [https://www.percona.com/blog/the-mysql-query-cache-how-it-works-and-workload-impacts-both-good-and-bad/](https://www.percona.com/blog/the-mysql-query-cache-how-it-works-and-workload-impacts-both-good-and-bad/)
[13] [https://dev.mysql.com/doc/refman/5.7/en/query-cache-operation.html](https://dev.mysql.com/doc/refman/5.7/en/query-cache-operation.html)
[14] [https://docs.aws.amazon.com/ja_jp/dms/latest/oracle-to-aurora-mysql-migration-playbook/chap-oracle-aurora-mysql.special.cache.html](https://docs.aws.amazon.com/ja_jp/dms/latest/oracle-to-aurora-mysql-migration-playbook/chap-oracle-aurora-mysql.special.cache.html)
[15] [https://proxysql.com/documentation/query-cache/](https://proxysql.com/documentation/query-cache/)
[16] [https://dev.mysql.com/doc/refman/8.0/ja/added-deprecated-removed.html](https://dev.mysql.com/doc/refman/8.0/ja/added-deprecated-removed.html)
[17] [https://github.com/symphonycms/symphonycms/issues/2909](https://github.com/symphonycms/symphonycms/issues/2909)
[18] [https://www.managedserver.eu/the-reasons-why-the-mysql-query-cache-was-abandoned-starting-with-mysql-8/](https://www.managedserver.eu/the-reasons-why-the-mysql-query-cache-was-abandoned-starting-with-mysql-8/)
[19] [https://blog.kinto-technologies.com/posts/2023-05-10-AuroraMySQLTroubleShooting_en/](https://blog.kinto-technologies.com/posts/2023-05-10-AuroraMySQLTroubleShooting_en/)
[20] [https://dev.mysql.com/blog-archive/mysql-8-0-retiring-support-for-the-query-cache/](https://dev.mysql.com/blog-archive/mysql-8-0-retiring-support-for-the-query-cache/)
[21] [https://www.techwell.com/techwell-insights/2023/06/mysql-8-doesn-t-support-some-features-you-may-have-used](https://www.techwell.com/techwell-insights/2023/06/mysql-8-doesn-t-support-some-features-you-may-have-used)
[22] [https://stackoverflow.com/questions/58580401/mysql-8-disable-query-cache-for-current-session](https://stackoverflow.com/questions/58580401/mysql-8-disable-query-cache-for-current-session)
[23] [https://www.digitalocean.com/community/tutorials/how-to-optimize-mysql-with-query-cache-on-ubuntu-18-04](https://www.digitalocean.com/community/tutorials/how-to-optimize-mysql-with-query-cache-on-ubuntu-18-04)
[24] [https://www.linkedin.com/pulse/mysql-query-cache-how-use-improve-performance-saeed-anabtawi](https://www.linkedin.com/pulse/mysql-query-cache-how-use-improve-performance-saeed-anabtawi)
[25] [https://experienceleague.adobe.com/en/docs/commerce-learn/tutorials/backend-development/mysql-query-cache](https://experienceleague.adobe.com/en/docs/commerce-learn/tutorials/backend-development/mysql-query-cache)
[26] [https://dba.stackexchange.com/questions/217577/why-did-mysql-remove-the-query-cache-feature-after-version-8-0](https://dba.stackexchange.com/questions/217577/why-did-mysql-remove-the-query-cache-feature-after-version-8-0)
[27] [https://stackoverflow.com/questions/58584596/mysql-8-warning-sql-no-cache-is-deprecated](https://stackoverflow.com/questions/58584596/mysql-8-warning-sql-no-cache-is-deprecated)
[28] [https://mysqlquicksand.wordpress.com/2020/05/08/10-reasons-why-mysql-query-cache-should-be-switched-off/](https://mysqlquicksand.wordpress.com/2020/05/08/10-reasons-why-mysql-query-cache-should-be-switched-off/)

---